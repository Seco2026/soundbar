<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Soundboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  margin:0; padding:0; font-family:Arial,sans-serif;
  display:flex; flex-direction:column; height:100vh;
  background:#f2f2f2;
}

/* TOPPBAR */
#topBar {
  background:#fff;
  box-shadow:0 2px 5px rgba(0,0,0,0.15);
  padding:5px 10px;
  box-sizing:border-box;
  flex-shrink:0;
}

/* ADMIN PANEL */
#adminPanel {
  display:none; 
  border:1px dashed #999; border-radius:8px; padding:10px;
  background:#fafafa; max-height:150px; overflow:auto;
}

#adminPanel label, #adminPanel input, #adminPanel select, #adminPanel button {
  display:block; width:100%; margin:5px 0; box-sizing:border-box;
  font-size:16px;
}

#adminPanel input[type="file"] { padding:5px; }

/* GRID KNAPPAR */
.grid-container {
  flex-grow:1;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
  padding:10px;
  box-sizing:border-box;
  overflow:auto;
}

/* 3D-knappar med glans och rundade hörn */
.btn {
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  border:none; border-radius:20px;
  font-weight:bold; font-size:clamp(16px,4vw,24px);
  color:white; cursor:pointer;
  display:flex; justify-content:center; align-items:center;
  text-align:center; padding:0; word-break:break-word;
  box-shadow: 0 4px 0 rgba(0,0,0,0.2), 0 6px 10px rgba(0,0,0,0.1);
  overflow:hidden;
  transition: all 0.2s;
}

.btn.green {background: linear-gradient(to top, #4CAF50 0%, #6FCF70 100%);}
.btn.red   {background: linear-gradient(to top, #F44336 0%, #FF6F61 100%);}
.btn.blue  {background: linear-gradient(to top, #2196F3 0%, #4FC3F7 100%);}
.btn.orange{background: linear-gradient(to top, #FF9800 0%, #FFB74D 100%);}
.btn.purple{background: linear-gradient(to top, #9C27B0 0%, #BA68C8 100%);}

/* 3D-effekt vid tryck */
.btn:active { transform: translateY(4px); box-shadow:0 2px 0 rgba(0,0,0,0.2),0 3px 5px rgba(0,0,0,0.1); }

/* Glans */
.btn::before {
  content:""; position:absolute; top:0; left:-75%;
  width:50%; height:100%;
  background: linear-gradient(120deg, rgba(255,255,255,0.3), rgba(255,255,255,0));
  transform: skewX(-25deg);
}
.btn:hover::before, .btn:active::before { animation: shine 1s forwards; }
@keyframes shine { 0% {left:-75%;} 100% {left:125%;} }

.btn span { z-index:1; }

/* Logga ut */
#logout { margin-top:5px; padding:8px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<div id="topBar">
  <div id="adminPanel">
    <h3>Admin – Byt ljud och namn</h3>

    <label>Välj knapp:</label>
    <select id="buttonNumber"></select>

    <label>Ny knapptext:</label>
    <input type="text" id="newName" placeholder="Nytt namn">
    <button onclick="changeName()">Spara namn</button>

    <label>Ladda upp ljud:</label>
    <input type="file" id="fileInput" accept="audio/*">
    <button onclick="previewSound()">Förhandslyssna</button>
    <button onclick="uploadSound()">Ladda upp ljud</button>
  </div>

  <button id="logout" onclick="logout()">Logga ut</button>
</div>

<div class="grid-container" id="buttons"></div>

<script>
/* === FIREBASE === */
const firebaseConfig = {
  apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
  authDomain: "savehof26.firebaseapp.com",
  projectId: "savehof26",
  storageBucket: "savehof26.firebasestorage.app",
  databaseURL: "https://savehof26-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const storage = firebase.storage();
const db = firebase.database();

const colors = ["green","green","green","red","red","red","blue","blue","blue","orange","orange","orange","purple","purple","purple"];
let currentAudio = null;
let previewAudio = null;

/* === Fyll knappval i adminpanel === */
for(let i=1;i<=15;i++){
  const option=document.createElement("option");
  option.value=i; option.textContent=`Knapp ${i}`;
  document.getElementById("buttonNumber").appendChild(option);
}

/* === Skapa knappar === */
function loadButtons(){
  const container=document.getElementById("buttons");
  container.innerHTML="";
  for(let i=1;i<=15;i++){
    const btn=document.createElement("button");
    btn.className="btn "+colors[i-1];
    btn.id="btn"+i;
    const span = document.createElement("span");
    span.textContent="Knapp "+i;
    btn.appendChild(span);
    btn.onclick=()=>playSound(i);
    container.appendChild(btn);
  }

  db.ref("buttons").once("value").then(snapshot=>{
    snapshot.forEach(snap=>{
      const id = snap.key;
      const name = snap.val().name;
      const button = document.getElementById("btn"+id);
      if(button) button.querySelector("span").textContent=name;
    });
  });
}

/* === Spela ljud med start/stop === */
function playSound(nr){
  if(currentAudio){ currentAudio.pause(); currentAudio=null; return; }
  db.ref(`buttons/${nr}/audio`).once("value").then(snap=>{
    const url = snap.val();
    if(!url) return;
    currentAudio = new Audio(url);
    currentAudio.play();
    currentAudio.onended=()=>currentAudio=null;
  });
}

/* === Byt namn på knapp === */
function changeName(){
  const nr=document.getElementById("buttonNumber").value;
  const newName=document.getElementById("newName").value.trim();
  if(!nr||!newName){ alert("Välj knapp och fyll i namn"); return; }
  db.ref("buttons/"+nr).update({name:newName});
  document.getElementById("btn"+nr).querySelector("span").textContent=newName;
  document.getElementById("newName").value="";
}

/* === Förhandslyssna ljud === */
function previewSound(){
  const file=document.getElementById("fileInput").files[0];
  if(!file){ alert("Välj en ljudfil först"); return; }

  if(previewAudio){ previewAudio.pause(); previewAudio=null; }

  const audio=document.createElement("audio");
  audio.src=URL.createObjectURL(file);
  audio.onloadedmetadata=()=>{
    if(audio.duration>15){ alert("Ljudet är längre än 15 sekunder"); return; }
    previewAudio=audio;
    previewAudio.play();
  }
}

/* === Ladda upp ljud till knapp === */
function uploadSound(){
  const nr=document.getElementById("buttonNumber").value;
  const file=document.getElementById("fileInput").files[0];
  if(!nr||!file){ alert("Välj knapp och ljudfil"); return; }

  const audio=document.createElement("audio");
  audio.src=URL.createObjectURL(file);
  audio.onloadedmetadata=()=>{
    if(audio.duration>15){ alert("Ljudet är längre än 15 sekunder"); return; }
    const uploadTask=storage.ref(`sounds/${nr}`).put(file);
    uploadTask.then(()=>{
      storage.ref(`sounds/${nr}`).getDownloadURL().then(url=>{
        db.ref(`buttons/${nr}`).update({audio:url});
        alert("Ljud uppdaterat!");
      });
    });
  }
}

/* === Logga ut === */
function logout(){ auth.signOut().then(()=>window.location.replace("index.html")); }

/* === Kontrollera inloggning och visa adminpanel === */
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.replace("index.html"); return; }
  if(user.email==="2014supporter-admin@soundbar.se"){
    document.getElementById("adminPanel").style.display="block";
  }
  loadButtons();
});
</script>

</body>
</html>
