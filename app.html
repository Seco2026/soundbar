<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soundboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f0f0f0;
}

#topbar {
  background:#222;
  color:white;
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}

#topbar button {
  padding:6px 10px;
}

#grid {
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:10px;
  padding:10px;
}

.sound-btn {
  height:100px;
  font-size:18px;
  font-weight:bold;
  border:none;
  border-radius:12px;
  color:white;
}

.green { background:green; }
.red { background:red; }
.blue { background:blue; }
.orange { background:orange; }
.purple { background:purple; }
</style>
</head>

<body>

<div id="topbar">
  <span id="userInfo"></span>

  <!-- ADMIN -->
  <div id="adminControls" style="display:none;">
    <select id="btnSelect"></select>
    <input type="file" id="fileInput" accept="audio/*">
    <button id="uploadBtn">Byt ljud</button>
  </div>

  <button onclick="logout()">Logga ut</button>
</div>

<div id="grid"></div>

<script>
/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
  authDomain: "savehof26.firebaseapp.com",
  projectId: "savehof26",
  databaseURL: "https://savehof26-default-rtdb.europe-west1.firebasedatabase.app",
  storageBucket: "savehof26.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

const adminEmail = "2014supporter-admin@soundbar.se";

let currentAudio = null;

/* ===== SKAPA KNAPPAR ===== */
const colors = [
  "green","green","green",
  "red","red","red",
  "blue","blue","blue",
  "orange","orange","orange",
  "purple","purple","purple"
];

const grid = document.getElementById("grid");
const btnSelect = document.getElementById("btnSelect");

for (let i=1;i<=15;i++){
  const btn=document.createElement("button");
  btn.className="sound-btn "+colors[i-1];
  btn.innerText="Knapp "+i;
  btn.onclick=()=>playSound(i);
  grid.appendChild(btn);

  const opt=document.createElement("option");
  opt.value=i;
  opt.innerText="Knapp "+i;
  btnSelect.appendChild(opt);
}

/* ===== SPELA LJUD ===== */
function playSound(nr){
  if(currentAudio){
    currentAudio.pause();
    currentAudio=null;
    return;
  }

  db.ref("buttons/"+nr).once("value").then(s=>{
    const url=s.val();
    if(!url){ alert("Inget ljud sparat"); return; }
    currentAudio=new Audio(url);
    currentAudio.play();
    currentAudio.onended=()=>currentAudio=null;
  });
}

/* ===== ADMIN UPPLADDNING ===== */
document.getElementById("uploadBtn").onclick = function(){
  alert("Upload klickad");

  const nr = btnSelect.value;
  const file = fileInput.files[0];
  if(!file){ alert("Ingen fil vald"); return; }

  const audio = document.createElement("audio");
  audio.src = URL.createObjectURL(file);

  audio.onloadedmetadata = function(){
    if(audio.duration > 15){
      alert("Ljudet är för långt");
      return;
    }

    const ref = storage.ref("sounds/knapp_"+nr);
    ref.put(file)
      .then(()=>ref.getDownloadURL())
      .then(url=>{
        return db.ref("buttons/"+nr).set(url);
      })
      .then(()=>{
        alert("Ljud sparat!");
      })
      .catch(e=>alert("Fel: "+e.message));
  };
};

/* ===== LOGGA UT ===== */
function logout(){
  auth.signOut().then(()=>location.href="index.html");
}

/* ===== AUTH ===== */
auth.onAuthStateChanged(user=>{
  if(!user){ location.href="index.html"; return; }

  document.getElementById("userInfo").innerText=user.email;

  if(user.email===adminEmail){
    document.getElementById("adminControls").style.display="flex";
  }
});
</script>

</body>
</html>
