<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soundboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f0f0f0;
  height:100vh;
  display:flex;
  flex-direction:column;
}

#topbar {
  height:50px;
  background:#222;
  color:white;
  display:none;
  align-items:center;
  padding:5px;
  gap:5px;
}

#grid {
  flex:1;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  padding:10px;
}

.sound-btn {
  aspect-ratio:1/1;
  border:none;
  border-radius:18px;
  font-weight:bold;
  font-size:18px;
  color:white;
  cursor:pointer;
  box-shadow:0 5px 8px rgba(0,0,0,0.3);
}

.green{background:linear-gradient(#7CFC90,#2E8B57);}
.red{background:linear-gradient(#FF7F7F,#C62828);}
.blue{background:linear-gradient(#6EC6FF,#1565C0);}
.orange{background:linear-gradient(#FFD180,#EF6C00);}
.purple{background:linear-gradient(#CE93D8,#6A1B9A);}
</style>
</head>

<body>

<div id="topbar">
  <select id="btnSelect"></select>
  <input type="file" id="fileInput" accept="audio/*">
  <button onclick="uploadSound()">Byt ljud</button>
</div>

<div id="grid"></div>

<script>
/* === FIREBASE === */
const firebaseConfig = {
  apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
  authDomain: "savehof26.firebaseapp.com",
  projectId: "savehof26",
  databaseURL: "https://savehof26-default-rtdb.firebaseio.com",
  storageBucket: "savehof26.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

const adminEmail = "2014supporter-admin@soundbar.se";
const colors = ["green","green","green","red","red","red","blue","blue","blue","orange","orange","orange","purple","purple","purple"];

let currentAudio = null;

/* === SKAPA KNAPPAR === */
const grid = document.getElementById("grid");
for(let i=1;i<=15;i++){
  const btn=document.createElement("button");
  btn.className=`sound-btn ${colors[i-1]}`;
  btn.textContent="Knapp "+i;
  btn.onclick=()=>playSound(i);
  grid.appendChild(btn);

  const opt=document.createElement("option");
  opt.value=i;
  opt.textContent="Knapp "+i;
  btnSelect.appendChild(opt);
}

/* === SPELA LJUD === */
function playSound(nr){
  if(currentAudio){
    currentAudio.pause();
    currentAudio=null;
    return;
  }
  db.ref("buttons/"+nr).once("value").then(snap=>{
    const url=snap.val();
    if(!url) return;
    currentAudio=new Audio(url);
    currentAudio.play();
    currentAudio.onended=()=>currentAudio=null;
  });
}

/* === ADMIN: LADDA UPP LJUD === */
function uploadSound(){
  const nr=btnSelect.value;
  const file=fileInput.files[0];
  if(!nr||!file){ alert("V채lj knapp och fil"); return; }

  const audio=document.createElement("audio");
  audio.src=URL.createObjectURL(file);
  audio.onloadedmetadata=()=>{
    if(audio.duration>15){
      alert("Ljudet 채r l채ngre 채n 15 sekunder");
      return;
    }

    const ref=storage.ref("sounds/"+nr);
    ref.put(file).then(()=>{
      ref.getDownloadURL().then(url=>{
        db.ref("buttons/"+nr).set(url);
        alert("Ljud uppdaterat!");
      });
    });
  };
}

/* === INLOGGNING === */
auth.onAuthStateChanged(user=>{
  if(!user){ location.href="index.html"; return; }
  if(user.email===adminEmail){
    document.getElementById("topbar").style.display="flex";
  }
});
</script>

</body>
</html>

