<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Soundboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
/* --- Grundlayout --- */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #f0f0f0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* --- Topbar --- */
#topbar {
  background: #222;
  color: white;
  padding: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}
#adminControls {
  display: none;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}
input[type=file], select, #uploadBtn {
  padding: 8px;
  font-size: 14px;
  border-radius: 5px;
  border: none;
}
#uploadBtn { background:#28a745; color:white; cursor:pointer; }

/* --- Grid med 3 kolumner --- */
#grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3 knappar per rad */
  gap: 15px;
  padding: 20px;
  flex-grow: 1;
}

/* --- Knappar kvadratiska --- */
#grid button {
  width: 100%;
  aspect-ratio: 1 / 1; /* gör kvadratisk knapp */
  border-radius: 15px;
  border: none;
  font-size: 16px;
  font-weight: bold;
  color: white;
  box-shadow: 0 4px #999;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
}
#grid button:active {
  transform: translateY(4px);
  box-shadow: 0 0 #999;
}
</style>
</head>

<body>

<div id="topbar">
  <span id="userInfo">Ej inloggad</span>
  <div id="adminControls">
    <select id="btnSelect"></select>
    <input type="file" id="fileInput" accept="audio/*">
    <button id="uploadBtn">Byt ljud</button>
  </div>
</div>

<div id="grid"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("✅ SCRIPT LADDAT");

  // --- Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
    authDomain: "savehof26.firebaseapp.com",
    databaseURL: "https://savehof26-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "savehof26",
    storageBucket: "savehof26.appspot.com"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  const ADMIN_EMAIL = "2014supporter-admin@soundbar.se";

  const grid = document.getElementById("grid");
  const btnSelect = document.getElementById("btnSelect");

  const BUTTON_COUNT = 15;
  const colors = ["#e74c3c","#3498db","#2ecc71","#f1c40f","#9b59b6"]; // 5 grupper

  const buttons = [];

  // --- Skapa knappar ---
  for(let i=1;i<=BUTTON_COUNT;i++){
    const btn = document.createElement("button");
    btn.textContent = i;
    
    // Gruppfärg 3 knappar per färg
    const colorIndex = Math.floor((i-1)/3);
    btn.style.backgroundColor = colors[colorIndex] || "#95a5a6";

    btn.onclick = () => playSound(i);
    grid.appendChild(btn);
    buttons.push(btn);

    // Admin dropdown
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Knapp " + i;
    btnSelect.appendChild(opt);
  }

  // --- Spela ljud ---
  function playSound(nr){
    db.ref("buttons/"+nr).once("value")
      .then(snap=>{
        const url = snap.val();
        if(!url){ alert("Inget ljud sparat"); return; }
        new Audio(url).play().catch(e=>console.error("❌ Audio error:",e));
      })
      .catch(err=>console.error("❌ Play error:",err));
  }

  // --- Upload ljud ---
  function uploadSound(){
    const nr = btnSelect.value;
    const file = document.getElementById("fileInput").files[0];
    if(!file){ alert("❌ Ingen fil vald"); return; }

    const ref = storage.ref("sounds/knapp_"+nr);
    ref.put(file)
      .then(()=> ref.getDownloadURL())
      .then(url => db.ref("buttons/"+nr).set(url))
      .then(()=> alert("✅ LJUD SPARAT"))
      .catch(err => { console.error("❌ UPLOAD FEL:",err); alert("❌ FEL"); });
  }
  document.getElementById("uploadBtn").addEventListener("click", uploadSound);

  // --- Auth ---
  auth.onAuthStateChanged(user=>{
    if(!user){
      document.getElementById("userInfo").textContent="Ej inloggad";
      document.getElementById("adminControls").style.display="none";
      return;
    }
    document.getElementById("userInfo").textContent = user.email;
    if(user.email===ADMIN_EMAIL){
      document.getElementById("adminControls").style.display="flex";
    } else {
      document.getElementById("adminControls").style.display="none";
    }
  });

});
</script>

</body>
</html>
