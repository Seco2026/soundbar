<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Soundboard DEBUG</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    body { font-family: Arial; margin: 0; }
    #topbar { background:#222; color:white; padding:10px; display:flex; gap:10px; }
    #adminControls { display:none; gap:5px; }
    button { padding:10px; }
  </style>
</head>

<body>

<div id="topbar">
  <span id="userInfo">Ej inloggad</span>

  <div id="adminControls">
    <select id="btnSelect"></select>
    <input type="file" id="fileInput" accept="audio/*">
    <button id="uploadBtn">Byt ljud</button>
  </div>
</div>

<div id="grid"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  console.log("‚úÖ SCRIPT LADDAT");

  /******** FIREBASE ********/
  const firebaseConfig = {
    apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
    authDomain: "savehof26.firebaseapp.com",
    databaseURL: "https://savehof26-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "savehof26",
    storageBucket: "savehof26.appspot.com"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  const ADMIN_EMAIL = "2014supporter-admin@soundbar.se";

  /******** KNAPPAR ********/
  const grid = document.getElementById("grid");
  const btnSelect = document.getElementById("btnSelect");

  for (let i = 1; i <= 3; i++) {
    const btn = document.createElement("button");
    btn.textContent = "Knapp " + i;
    btn.onclick = () => playSound(i);
    grid.appendChild(btn);

    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Knapp " + i;
    btnSelect.appendChild(opt);
  }

  /******** SPELA ********/
  function playSound(nr) {
    console.log("‚ñ∂Ô∏è F√∂rs√∂ker spela knapp", nr);

    db.ref("buttons/" + nr).once("value")
      .then(snap => {
        console.log("DB v√§rde:", snap.val());
        if (!snap.val()) {
          alert("Inget ljud sparat");
          return;
        }
        new Audio(snap.val()).play();
      })
      .catch(err => console.error("‚ùå Play error:", err));
  }

  /******** UPPLADDNING ********/
  function uploadSound() {
    alert("üîî UPLOAD-KNAPP TRYCKT");
    console.log("üîî uploadSound() startad");

    const nr = btnSelect.value;
    const file = document.getElementById("fileInput").files[0];

    console.log("Knapp:", nr);
    console.log("Fil:", file);

    if (!file) {
      alert("‚ùå Ingen fil vald");
      return;
    }

    const ref = storage.ref("sounds/knapp_" + nr);

    ref.put(file)
      .then(() => {
        console.log("üì¶ Fil uppladdad");
        return ref.getDownloadURL();
      })
      .then(url => {
        console.log("üîó URL:", url);
        return db.ref("buttons/" + nr).set(url);
      })
      .then(() => {
        alert("‚úÖ LJUD SPARAT");
      })
      .catch(err => {
        console.error("‚ùå UPLOAD FEL:", err);
        alert("‚ùå FEL ‚Äì se Console");
      });
  }

  document.getElementById("uploadBtn")
    .addEventListener("click", uploadSound);

  /******** AUTH ********/
  auth.onAuthStateChanged(user => {
    console.log("üë§ Auth state:", user);

    if (!user) {
      alert("‚ùå INGEN INLOGGNING");
      return;
    }

    document.getElementById("userInfo").textContent = user.email;

    if (user.email === ADMIN_EMAIL) {
      document.getElementById("adminControls").style.display = "flex";
      console.log("üü¢ ADMIN INLOGGAD");
    }
  });

});
</script>

</body>
</html>
