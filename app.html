<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Soundboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f0f0f0; }
    #topbar {
      display: flex; align-items:center; justify-content:flex-start;
      background:#222; color:white; padding:5px 10px; height:50px; box-sizing:border-box;
    }
    #topbar input[type=file], #topbar select, #topbar button { margin-left:10px; }
    #button-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 10px;
    }
    .sound-btn {
      width: 100%;
      aspect-ratio: 1/1;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 0 #999;
      transition: all 0.2s;
      color: white;
    }
    .sound-btn:active { box-shadow: 0 2px 0 #666; transform: translateY(3px); }

    .btn1{background:#4CAF50;}  /* grön */
    .btn2{background:#4CAF50;}
    .btn3{background:#4CAF50;}
    .btn4{background:#f44336;}  /* röd */
    .btn5{background:#f44336;}
    .btn6{background:#f44336;}
    .btn7{background:#FF9800;}  /* orange */
    .btn8{background:#FF9800;}
    .btn9{background:#FF9800;}
    .btn10{background:#2196F3;} /* blå */
    .btn11{background:#2196F3;}
    .btn12{background:#2196F3;}
    .btn13{background:#9C27B0;} /* lila */
    .btn14{background:#9C27B0;}
    .btn15{background:#9C27B0;}
  </style>
</head>
<body>

<div id="topbar" style="display:none;">
  Admin:
  <select id="select-btn">
    <option value="">Välj knapp</option>
    <option value="0">Knapp 1</option>
    <option value="1">Knapp 2</option>
    <option value="2">Knapp 3</option>
    <option value="3">Knapp 4</option>
    <option value="4">Knapp 5</option>
    <option value="5">Knapp 6</option>
    <option value="6">Knapp 7</option>
    <option value="7">Knapp 8</option>
    <option value="8">Knapp 9</option>
    <option value="9">Knapp 10</option>
    <option value="10">Knapp 11</option>
    <option value="11">Knapp 12</option>
    <option value="12">Knapp 13</option>
    <option value="13">Knapp 14</option>
    <option value="14">Knapp 15</option>
  </select>
  <input type="file" id="file-input" accept="audio/*">
  <button onclick="uploadSound()">Byt ljud</button>
</div>

<div id="button-container">
  <button class="sound-btn btn1" data-sound="">Knapp 1</button>
  <button class="sound-btn btn2" data-sound="">Knapp 2</button>
  <button class="sound-btn btn3" data-sound="">Knapp 3</button>
  <button class="sound-btn btn4" data-sound="">Knapp 4</button>
  <button class="sound-btn btn5" data-sound="">Knapp 5</button>
  <button class="sound-btn btn6" data-sound="">Knapp 6</button>
  <button class="sound-btn btn7" data-sound="">Knapp 7</button>
  <button class="sound-btn btn8" data-sound="">Knapp 8</button>
  <button class="sound-btn btn9" data-sound="">Knapp 9</button>
  <button class="sound-btn btn10" data-sound="">Knapp 10</button>
  <button class="sound-btn btn11" data-sound="">Knapp 11</button>
  <button class="sound-btn btn12" data-sound="">Knapp 12</button>
  <button class="sound-btn btn13" data-sound="">Knapp 13</button>
  <button class="sound-btn btn14" data-sound="">Knapp 14</button>
  <button class="sound-btn btn15" data-sound="">Knapp 15</button>
</div>

<script>
  // FIREBASE
  const firebaseConfig = {
    apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
    authDomain: "savehof26.firebaseapp.com",
    projectId: "savehof26",
    storageBucket: "savehof26.appspot.com",
    messagingSenderId: "127568718392",
    appId: "1:127568718392:web:312399049492078e6254cd"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const storage = firebase.storage();

  const adminEmail = "2014supporter-admin@soundbar.se";

  let currentAudio = null;

  // Inloggad → visa/hide adminbar
  auth.onAuthStateChanged(user => {
    if(!user) { window.location.href="index.html"; return; }
    if(user.email === adminEmail) {
      document.getElementById("topbar").style.display = "flex";
    }
  });

  // Spela/stoppa ljud
  document.querySelectorAll(".sound-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const url = btn.getAttribute("data-sound");
      if(!url) return;

      if(currentAudio && !currentAudio.paused && currentAudio.src === url){
        currentAudio.pause();
        currentAudio.currentTime = 0;
      } else {
        if(currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
        currentAudio = new Audio(url);
        currentAudio.play();
        setTimeout(()=>{ currentAudio.pause(); currentAudio.currentTime = 0; },15000); // max 15 sek
      }
    });
  });

  // Admin: byt ljud
  function uploadSound(){
    const fileInput = document.getElementById("file-input");
    const select = document.getElementById("select-btn");
    const idx = select.value;
    if(!idx || !fileInput.files[0]) { alert("Välj knapp och fil!"); return; }

    const file = fileInput.files[0];
    if(file.duration && file.duration>15){ alert("Ljudet får max vara 15 sekunder"); return; }

    const storageRef = storage.ref("sounds/"+file.name);
    const uploadTask = storageRef.put(file);

    uploadTask.on('state_changed',
      null,
      error => { alert("Fel vid uppladdning: "+error.message); },
      ()=>{
        uploadTask.snapshot.ref.getDownloadURL().then(url=>{
          const btn = document.querySelectorAll(".sound-btn")[idx];
          btn.setAttribute("data-sound", url);
          alert("Ljud uppdaterat!");
        });
      }
    );
  }
</script>
</body>
</html>
