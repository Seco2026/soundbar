<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Soundboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background: #f0f0f0;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* --- Login sida --- */
#loginPage {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  gap: 10px;
}
#loginPage input {
  padding: 10px;
  font-size: 16px;
  border-radius: 5px;
  border: 1px solid #ccc;
}
#loginPage button {
  padding: 10px 16px;
  font-size: 16px;
  border-radius: 5px;
  border: none;
  background: #2980b9;
  color: white;
  cursor: pointer;
}

/* --- App sidan --- */
#appPage {
  display: none;
  flex-direction: column;
  min-height: 100vh;
}

/* --- Topbar --- */
#topbar {
  background: #222;
  color: white;
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 20px 15px;
  min-height: 100px;
  box-sizing: border-box;
}
#topbar span {
  font-size: 20px;
}
#adminControls {
  display: none;
  gap: 15px;
  align-items: center;
  flex-wrap: wrap;
}
#adminControls select,
#adminControls input,
#adminControls button,
#logoutBtn {
  padding: 14px 20px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
#uploadBtn { background:#28a745; color:white; }
#logoutBtn { background:#c0392b; color:white; }

/* --- Grid med 3 kolumner --- */
#grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 10px;
  flex-grow: 1;
}

/* --- Knappar kvadratiska med 3D-effekt och centrerad stor text --- */
#grid button {
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 15px;
  border: none;
  font-size: 72px; /* desktop font */
  font-weight: bold;
  color: white;
  box-shadow: 0 6px #999;
  cursor: pointer;
  transition: transform 0.1s, box-shadow 0.1s;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}
#grid button:active {
  transform: translateY(6px);
  box-shadow: 0 0 #999;
}

/* --- Mobilanpassning --- */
@media (max-width:600px){
  #topbar {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 160px;
    gap: 12px;
    padding: 20px;
  }
  #topbar span {
    font-size: 22px;
  }
  #adminControls select,
  #adminControls input,
  #adminControls button,
  #logoutBtn {
    font-size: 20px;
    padding: 16px 24px;
  }

  #loginPage input, #loginPage button {
    font-size: 16px;
    padding: 10px;
  }

  /* Knappar på mobil: mindre så alla får plats */
  #grid {
    gap: 6px;
  }
  #grid button {
    font-size: 36px;
    aspect-ratio: 1 / 1;
  }
}
</style>
</head>

<body>

<!-- Login sida -->
<div id="loginPage">
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Lösenord">
  <button id="loginBtn">Logga in</button>
</div>

<!-- App sida -->
<div id="appPage">
  <div id="topbar">
    <span id="userInfo">Ej inloggad</span>
    <div id="adminControls">
      <select id="btnSelect"></select>
      <input type="file" id="fileInput" accept="audio/*">
      <button id="uploadBtn">Byt ljud</button>
    </div>
    <button id="logoutBtn">Logga ut</button>
  </div>
  <div id="grid"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const firebaseConfig = {
    apiKey: "AIzaSyCjLYhiEys4dYfGvEJyhrDxCYv4rW-0nh8",
    authDomain: "savehof26.firebaseapp.com",
    databaseURL: "https://savehof26-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "savehof26",
    storageBucket: "savehof26.appspot.com"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  const ADMIN_EMAIL = "2014supporter-admin@soundbar.se";

  const loginPage = document.getElementById("loginPage");
  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const loginBtn = document.getElementById("loginBtn");

  const appPage = document.getElementById("appPage");
  const grid = document.getElementById("grid");
  const adminControls = document.getElementById("adminControls");
  const btnSelect = document.getElementById("btnSelect");
  const logoutBtn = document.getElementById("logoutBtn");

  const BUTTON_COUNT = 15;
  const colors = ["#e74c3c","#3498db","#2ecc71","#f1c40f","#9b59b6"];
  const buttons = [];

  // Skapa knappar
  for(let i=1;i<=BUTTON_COUNT;i++){
    const btn = document.createElement("button");
    btn.textContent = i;
    const colorIndex = Math.floor((i-1)/3);
    btn.style.backgroundColor = colors[colorIndex] || "#95a5a6";
    btn.onclick = () => playSound(i);
    grid.appendChild(btn);
    buttons.push(btn);

    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Knapp " + i;
    btnSelect.appendChild(opt);
  }

  function playSound(nr){
    db.ref("buttons/"+nr).once("value")
      .then(snap=>{
        const url = snap.val();
        if(!url){ alert("Inget ljud sparat"); return; }
        new Audio(url).play().catch(e=>console.error("❌ Audio error:",e));
      }).catch(err=>console.error("❌ Play error:",err));
  }

  function uploadSound(){
    const nr = btnSelect.value;
    const file = document.getElementById("fileInput").files[0];
    if(!file){ alert("❌ Ingen fil vald"); return; }
    const ref = storage.ref("sounds/knapp_"+nr);
    ref.put(file)
      .then(()=> ref.getDownloadURL())
      .then(url => db.ref("buttons/"+nr).set(url))
      .then(()=> alert("✅ LJUD SPARAT"))
      .catch(err => { console.error("❌ UPLOAD FEL:",err); alert("❌ FEL"); });
  }
  document.getElementById("uploadBtn").addEventListener("click", uploadSound);

  // --- Login ---
  loginBtn.addEventListener("click", ()=>{
    const email = loginEmail.value;
    const password = loginPassword.value;
    auth.signInWithEmailAndPassword(email,password)
      .then(userCred=>{
        loginPage.style.display="none";
        appPage.style.display="flex";
        logoutBtn.style.display="inline-block";
        if(userCred.user.email===ADMIN_EMAIL){
          adminControls.style.display="flex";
        } else {
          adminControls.style.display="none";
        }
      })
      .catch(err=>{
        console.error("❌ Login fel:",err);
        alert("Fel email eller lösenord");
      });
  });

  // --- Logout ---
  logoutBtn.addEventListener("click", ()=>{
    auth.signOut().then(()=>{
      alert("✅ Utloggad");
      loginPage.style.display="flex";
      appPage.style.display="none";
      loginEmail.value = "";
      loginPassword.value = "";
    });
  });

  // --- Auth state ---
  auth.onAuthStateChanged(user=>{
    if(user){
      loginPage.style.display="none";
      appPage.style.display="flex";
      logoutBtn.style.display="inline-block";
      if(user.email===ADMIN_EMAIL) adminControls.style.display="flex";
      else adminControls.style.display="none";
    } else {
      loginPage.style.display="flex";
      appPage.style.display="none";
      logoutBtn.style.display="none";
    }
  });
});
</script>
</body>
</html>
